import"./modulepreload-polyfill-3cfb730f.js";import{W as v,C as b,S as C,P as L,O as E,a as I,c as T,b as R,d as w,M as u,B as p,e as y,V as l,f as j,g,h as A,i as P,j as W,k as H,A as Y}from"./solid-2a36ba3a.js";class O{constructor(){this.renderer,this.scene,this.camera,this.directionalLight,this.ambientLight,this.controls,this.clock}init(t,e){this.renderer=new v({antialias:!0,alpha:!0}),this.renderer.setClearColor(new b(t.clearColor)),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),document.getElementById("webgl").appendChild(this.renderer.domElement),this.scene=new C,this.camera=new L(e.fov,window.innerWidth/window.innerHeight,e.near,e.far),this.camera.position.set(e.pos.x,e.pos.y,e.pos.z),this.controls=new E(this.camera,this.renderer.domElement),this.clock=new I}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}}function V(){const[m,t]=R("default");return{status:m,setStatus:t}}const c=T(V);class N{constructor(){this.obj=new w,this.initialPosY=-3,this.theta=0,this.shakeR=.3}create(t){return new Promise(e=>{this.obj=new u(new p(20,1,80).translate(0,-.6,-25),new y({color:3355443})),this.obj.position.y=this.initialPosY,this.obj.userData.pause=!1,t.add(this.obj),e()})}shake(t,e){this.theta+=t,this.obj.position.y-=Math.sin(this.theta*20)*this.shakeR,this.theta*20>Math.PI*2&&(this.theta=0,e===0?this.shakeR-=.1:this.shakeR-=.3,this.obj.position.y=this.initialPosY,this.shakeR<=0&&(this.shakeR=.3,c.status()==="look"?c.setStatus("activateEyes"):c.setStatus("roll")))}}class G{constructor(){this.obj=new w,this.boxSize=10,this.jumpHeight=0,this.theta=0,this.eyeTheta=0,this.initialPos={x:0,y:this.boxSize*.5,z:-45},this.savedPos=new l(this.initialPos.x,this.initialPos.y,this.initialPos.z),this.eyes=new w,this.eyeBeams=[],this.eyeBeamCones=[],this.spotLightTargets=[]}create(t,e){return new Promise(s=>{const o=new p(this.boxSize,this.boxSize,this.boxSize),r=new y({color:6371033});this.obj=new u(o,r),this.obj.position.set(this.initialPos.x,this.initialPos.y,this.initialPos.z),this.obj.userData.rollIndex=0,this.obj.userData.rollCount=0,this.obj.userData.lookIndex=0,this.obj.userData.state="roll",t.add(this.obj);const i=1.5,a=new u(new p(i*1.5,i,i).translate(0,i*-.5,-1*i*.5+.1),r),x=a.clone();a.position.set(this.boxSize*.3,0,0),x.position.set(this.boxSize*-.3,0,0),this.eyes.add(a),this.eyes.add(x),this.eyes.visible=!1,t.add(this.eyes),this.spotLightTargets[0]=new u(new p(1,1,1),new j),this.spotLightTargets[0].position.set(this.boxSize*.3,-3,-2),this.spotLightTargets[0].userData.initialPosX=this.boxSize*.3,this.spotLightTargets[0].visible=!1,e.add(this.spotLightTargets[0]),this.spotLightTargets[1]=this.spotLightTargets[0].clone(),this.spotLightTargets[1].position.set(this.boxSize*-.3,-3,-2),this.spotLightTargets[1].userData.initialPosX=this.boxSize*-.3,e.add(this.spotLightTargets[1]),this.eyeBeams[0]=new g(16777215,2,11,Math.PI*.06,.2,.1),this.eyeBeams[0].position.set(0,0,-.1),this.eyeBeams[0].target=this.spotLightTargets[0],this.eyeBeams[1]=new g(16777215,2,11,Math.PI*.06,.2,.1),this.eyeBeams[1].position.set(0,0,-.1),this.eyeBeams[1].target=this.spotLightTargets[1],a.add(this.eyeBeams[0]),x.add(this.eyeBeams[1]),this.eyeBeamCones[0]=new u(new A(1.8,12,32,1,!1).translate(0,-5.5,-.1).rotateX(Math.PI*.1),new P({color:16777215,transparent:!0,opacity:.1})),this.eyeBeamCones[0].name="rightEyeBeamCone",a.add(this.eyeBeamCones[0]),this.eyeBeamCones[1]=this.eyeBeamCones[0].clone(),this.eyeBeamCones[1].name="left EyeBeamCone",x.add(this.eyeBeamCones[1]);const f=new u(new W(.4,40,40),new P(16777215));f.name="rightEyeBall",f.position.set(0,-1.67,-.616),this.eyeBeamCones[0].add(f);const k=f.clone();this.eyeBeamCones[1].add(k);const B=Math.sqrt(2)*(this.boxSize*.5);this.jumpHeight=B-this.boxSize*.5,s()})}roll(t){let e=this.theta%(Math.PI*.5)/(Math.PI*.5);switch(e=e*.02+t*.5,this.obj.userData.rollIndex){case 0:this.rollBox("forth",e,4,"look");break;case 1:this.rollBox("right",e*2,1,"pause");break;case 2:this.rollBox("back",e*3,4,"pause");break;case 3:this.rollBox("left",e*2,1,"pause");break}}rollBox(t,e,s,o){this.theta+=e;const i={forth:{axis:new l(1,0,0),moveDir:["z",1]},back:{axis:new l(-1,0,0),moveDir:["z",-1]},right:{axis:new l(0,0,-1),moveDir:["x",1]},left:{axis:new l(0,0,1),moveDir:["x",-1]}}[t];this.obj.rotateOnWorldAxis(i.axis,e);const a=Math.abs(Math.sin(this.theta*2));if(this.obj.position.y=a*this.jumpHeight+this.initialPos.y,this.obj.position[i.moveDir[0]]+=e/(Math.PI*.5)*this.boxSize*i.moveDir[1],this.theta>Math.PI*.5){const x=Math.PI*.5-this.theta;this.obj.rotateOnWorldAxis(i.axis,x),this.obj.position[i.moveDir[0]]=this.boxSize*i.moveDir[1]+this.savedPos[i.moveDir[0]],this.obj.position.y=this.savedPos.y,this.savedPos.copy(this.obj.position),this.obj.userData.rollCount++,this.theta=0,c.setStatus("pause")}this.obj.userData.rollCount>=s&&(this.obj.userData.rollCount=0,this.obj.userData.rollIndex++,this.obj.userData.rollIndex=this.obj.userData.rollIndex>=4?0:this.obj.userData.rollIndex,c.setStatus(o))}activateEyes(t){switch(this.obj.userData.lookIndex){case 0:this.eyes.position.set(this.obj.position.x,this.obj.position.y+this.boxSize*.35,this.obj.position.z+this.boxSize*.5),this.eyes.visible=!0,this.obj.userData.lookIndex++;break;case 1:this.eyes.rotation.x-=t*.5,this.eyes.rotation.x<-Math.PI*.2&&(this.obj.userData.lookIndex=0,c.setStatus("lookAround"),this.spotLightTargets.forEach(e=>{e.position.z=2.58}));break}}lookAround(t){this.eyeTheta+=t,this.spotLightTargets.forEach((e,s)=>{e.position.x=Math.sin(this.eyeTheta*1.5+1.5*s)*2.6+e.userData.initialPosX}),this.eyeBeamCones.forEach((e,s)=>{e.rotation.z=Math.sin(this.eyeTheta*1.5+1.5*s)*.3}),this.eyeTheta>Math.PI*2.5&&(this.spotLightTargets.forEach(e=>{e.position.z=-2}),c.setStatus("disableEyes"),this.eyeTheta=0)}disableEyes(t){this.eyes.rotation.x+=t,this.eyes.rotation.x>0&&(this.eyes.visible=!1,this.eyeTheta=0,this.eyeBeams.forEach(e=>{e.target.position.x=0}),this.eyeBeamCones.forEach(e=>{e.rotation.z=0}),c.setStatus("roll"))}}class X{constructor(){this.objs=[],this.boxSize=.2,this.theta=0,this.rollTheta=0,this.state="setDir",this.nextPosSet=!1}create(t){return new Promise(e=>{const s=new p(this.boxSize,this.boxSize,this.boxSize),o=[new b(65493),new b(46079),new b(16777215)],r=[];for(let i=0;i<o.length;i++)r[i]=new y({color:o[i]});for(let i=0;i<150;i++){const a=new u(s,r[Math.floor(Math.random()*o.length)]);a.scale.setScalar(1+.03*(i%5)),a.userData.initialPosY=this.boxSize*a.scale.x*.5,a.position.set((Math.random()*2-1)*8,a.userData.initialPosY,Math.random()*4+1),a.userData.nextPos=new l().copy(a.position),a.userData.jumpHeight=Math.sqrt(2)*(this.boxSize*a.scale.x*.5)-this.boxSize*a.scale.x*.5,a.userData.rollAxisVector=new l,a.userData.moveAxis="",a.userData.moveDir=1,a.userData.theta=0,a.userData.state="setDir",t.add(a),this.objs.push(a)}e()})}resetRollAndPause(t){this.resetRoll(),this.theta*20>Math.PI?this.objs.forEach(e=>{e.position.y=e.userData.initialPosY}):(this.theta+=t,this.objs.forEach((e,s)=>{e.position.y=Math.sin(this.theta*20)*.5+s%10*.1+e.userData.initialPosY}))}scatter(t,e){this.objs.forEach(s=>{const o=[];o[0]=s.getWorldPosition(new l).distanceTo(e[0].position),o[1]=s.getWorldPosition(new l).distanceTo(e[1].position);let r=o[0]<o[1]?0:1;switch(s.userData.state){case"setDir":const i=new l().subVectors(s.position,e[r].position).normalize();i.z=Math.abs(i.z),this.setDir(s,i),s.userData.state="roll";break;case"roll":s.userData.speed=Math.pow(1/o[r],3)*.1,this.roll(s,t);break}})}resetRollAndSetNextPos(){this.theta=0,this.nextPosSet&&(this.nextPosSet=!1),this.resetRoll(),this.nextPosSet||(this.objs.forEach(t=>{this.setNextPos(t)}),this.nextPosSet=!0)}wander(t){this.theta=0,this.objs.forEach((e,s)=>{if(e.position.distanceTo(e.userData.nextPos)<.2)e.position.copy(e.userData.nextPos);else switch(e.userData.state){case"setDir":const o=new l().subVectors(e.userData.nextPos,e.position).normalize();e.userData.speed=s%3*.01,this.setDir(e,o),e.userData.state="roll";break;case"roll":this.roll(e,t*10);break}})}setNextPos(t){t.userData.nextPos.set((Math.random()*2-1)*8,t.userData.initialPosY,Math.random()*4+1)}setDir(t,e){t.userData.moveAxis=Math.abs(e.x)>Math.abs(e.z)?"x":"z",t.userData.rollAxis=Math.abs(e.x)>Math.abs(e.z)?"z":"x",t.userData.moveDir=e[t.userData.moveAxis]>0?1:-1}roll(t,e){const s=e+t.userData.speed;t.userData.theta+=s,t.userData.moveAxis==="x"?t.userData.rollAxisVector.set(0,0,t.userData.moveDir*-1):t.userData.rollAxisVector.set(t.userData.moveDir,0,0),t.rotateOnWorldAxis(t.userData.rollAxisVector,s);const o=Math.abs(Math.sin(t.userData.theta*2));if(t.position.y=o*t.userData.jumpHeight+t.userData.initialPosY,t.position[t.userData.moveAxis]+=s/(Math.PI*.5)*this.boxSize*t.scale.x*t.userData.moveDir,t.userData.theta>Math.PI*.5){const r=Math.PI*.5-t.userData.theta;t.rotateOnWorldAxis(t.userData.rollAxisVector,r),t.userData.theta=0,t.userData.state="setDir"}}resetRoll(){this.objs.forEach(t=>{t.userData.state==="roll"&&(t.userData.state="setDir",t.userData.theta=0,t.rotation.set(0,0,0))})}}class q{constructor(){this.items={}}create(t){return new Promise(e=>{this.createLights(t),this.items.field=new N;const s=this.items.field.create(t);this.items.boss=new G;const o=this.items.boss.create(this.items.field.obj,t);this.items.miniCubes=new X;const r=this.items.miniCubes.create(this.items.field.obj);Promise.all([s,o,r]).then(e)})}getItems(){return this.items}createLights(t){this.items.pointLight1=new H(16777215,2,20),this.items.pointLight1.position.set(0,3.4,-35),t.add(this.items.pointLight1),this.items.ambientLight=new Y(16777215,.2),t.add(this.items.ambientLight)}}const d=new O,S=new q;let h,D=0,z=0,n=0;window.addEventListener("load",()=>{d.init(F,J),S.create(d.scene).then(()=>{h=S.getItems(),K(),M(),d.clock.start()})});window.addEventListener("resize",()=>{d.resize()});const F={clearColor:1580079},J={fov:60,near:.1,far:100,pos:{x:0,y:-.5,z:10}};function K(){c.setStatus("roll")}function Q(){switch(c.status()){case"roll":h.boss.roll(n),h.miniCubes.wander(n),h.pointLight1.position.x=h.boss.obj.position.x,h.pointLight1.position.z=h.boss.obj.position.z+15;break;case"look":h.pointLight1.position.z=13.74;case"pause":h.field.shake(n,h.boss.obj.userData.rollIndex),h.miniCubes.resetRollAndPause(n);break;case"activateEyes":h.boss.activateEyes(n);break;case"lookAround":h.boss.lookAround(n),h.miniCubes.scatter(n,h.boss.spotLightTargets);break;case"disableEyes":h.boss.disableEyes(n),h.miniCubes.resetRollAndSetNextPos();break}}function M(){requestAnimationFrame(M),D=d.clock.getElapsedTime(),n=D-z,n=Math.max(0,Math.min(n,.2)),z=D,Q(),d.renderer.render(d.scene,d.camera)}
